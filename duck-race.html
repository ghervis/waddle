<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Duck Race with Skills</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Volume Control Button -->
    <button class="volume-btn" id="volumeBtn" onclick="toggleVolume()">
      🔊
    </button>

    <!-- Background Music -->
    <audio id="backgroundMusic" loop>
      <source src="duck-song.mp3" type="audio/mpeg" />
    </audio>

    <button class="collapse-btn" id="collapseBtn" onclick="toggleSidebar()">
      ◀
    </button>

    <div class="sidebar" id="sidebar">
      <!-- Header with title and buttons -->
      <div class="sidebar-header">
        <h2>🦆 Racers</h2>
        <div class="header-buttons">
          <button id="addRacerBtn" class="header-btn add-btn">➕ Add</button>
          <button id="startBtn" class="header-btn start-btn">
            🏁 <span class="startBtn-text">Start</span>
          </button>
        </div>
      </div>

      <div id="leaderboard" class="leaderboard"></div>

      <details class="skill-list">
        <summary>
          <h3 style="display: inline">Skills</h3>
        </summary>
        <div class="skill-item">
          <strong>⏩ Boost:</strong> +10% speed for 3s
        </div>
        <div class="skill-item">
          <strong>💣 Bomb:</strong> Stun leader for 2s
        </div>
        <div class="skill-item">
          <strong>🌊 Splash:</strong> -5% speed to all, +5% per affected to
          caster for 2s
        </div>
        <div class="skill-item">
          <strong>🛡️ Immune:</strong> Immune to skills for 2s
        </div>
        <div class="skill-item">
          <strong>⚡ Lightning:</strong> Stun others for 1s (last place only)
        </div>
        <div class="skill-item">
          <strong>🧲 Magnet:</strong> Speed boost based on distance from leader
          (last place only)
        </div>
      </details>

      <h2 class="race-log-header">📜 Race Log</h2>
      <div id="log" class="log"></div>

      <!-- Settings Button -->
      <!-- prettier-ignore -->
      <button
        class="settings-btn"
        id="settingsBtn"
        onclick="window.game.openSettingsDialog()"
      >⚙️<span class="settings-btn-text">&nbsp;Settings</span>
      </button>
    </div>

    <div class="main-content">
      <div class="title-container">
        <input
          type="text"
          id="raceTitle"
          class="race-title-input"
          value="Waddle Waddle"
          maxlength="50"
        />
        <span class="edit-icon">✏️</span>
      </div>
      <div class="game-container">
        <canvas id="gameCanvas" width="800" height="400"></canvas>
      </div>
    </div>

    <script>
      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        const btn = document.getElementById("collapseBtn");

        sidebar.classList.toggle("collapsed");
        btn.classList.toggle("collapsed");
        btn.textContent = sidebar.classList.contains("collapsed") ? "▶" : "◀";
      }

      // Volume control functionality
      let isMuted = false;
      const backgroundMusic = document.getElementById("backgroundMusic");
      const volumeBtn = document.getElementById("volumeBtn");

      function toggleVolume() {
        isMuted = !isMuted;
        backgroundMusic.muted = isMuted;
        volumeBtn.textContent = isMuted ? "🔇" : "🔊";
        volumeBtn.classList.toggle("muted", isMuted);
      }

      // Initialize background music
      backgroundMusic.volume = 0.3; // 30% volume
      backgroundMusic.muted = false;

      // Play music when race starts
      window.playBackgroundMusic = function () {
        backgroundMusic.play().catch((error) => {
          console.log("Could not play background music:", error);
        });
      };

      // Stop music when race ends
      window.stopBackgroundMusic = function () {
        backgroundMusic.pause();
        backgroundMusic.currentTime = 0;
      };
    </script>
    <script src="duck-race.js"></script>
  </body>
</html>
