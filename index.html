<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Waddle</title>
    <meta name="description" content="Waddle waddle..." />

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="favicon.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />

    <!-- Open Graph / Discord Embed -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Waddle" />
    <meta property="og:description" content="🦆 Waddle waddle..." />
    <meta property="og:url" content="https://ghervis.github.io/waddle" />
    <meta property="og:site_name" content="Waddle" />
    <meta
      property="og:image"
      content="https://ghervis.github.io/waddle/favicon.png"
    />
    <meta property="og:image:width" content="256" />
    <meta property="og:image:height" content="256" />
    <meta
      property="og:image:alt"
      content="Yellow rubber duck head - Waddle racing game logo"
    />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Waddle" />
    <meta name="twitter:description" content="🦆 Waddle waddle..." />
    <meta
      name="twitter:image"
      content="https://ghervis.github.io/waddle/favicon.png"
    />

    <!-- Theme Color (Yellow for Discord embed border) -->
    <meta name="theme-color" content="#FFD700" />
    <meta name="msapplication-TileColor" content="#FFD700" />

    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Volume Control Button -->
    <button class="volume-btn" id="volumeBtn" onclick="toggleVolume()">
      🔊
    </button>

    <!-- Background Music -->
    <audio id="backgroundMusic" loop>
      <source src="duck-song.mp3" type="audio/mpeg" />
    </audio>

    <button class="collapse-btn" id="collapseBtn" onclick="toggleSidebar()">
      ◀
    </button>

    <div class="sidebar" id="sidebar">
      <!-- Header with title and buttons -->
      <div class="sidebar-header">
        <h2>🦆 Racers</h2>
        <div class="header-buttons">
          <button id="addRacerBtn" class="header-btn add-btn">➕ Add</button>
          <button id="startBtn" class="header-btn start-btn">
            🏁 <span class="startBtn-text">Start</span>
          </button>
        </div>
      </div>
      <div class="sidebar-content">
        <div id="leaderboard" class="leaderboard"></div>

        <details class="skill-list">
          <summary>
            <h3 style="display: inline">Skills</h3>
          </summary>
          <div class="skill-item">
            <strong>⏩ Boost:</strong> +10% speed for 3s
          </div>
          <div class="skill-item">
            <strong>💣 Bomb:</strong> Stun leader for 2s
          </div>
          <div class="skill-item">
            <strong>🌊 Splash:</strong> -5% speed to all, +5% per affected to
            caster for 2s
          </div>
          <div class="skill-item">
            <strong>🛡️ Immune:</strong> Immune to skills for 2s
          </div>
          <div class="skill-item">
            <strong>⚡ Lightning:</strong> Stun others for 1s (last place only)
          </div>
          <div class="skill-item">
            <strong>🧲 Magnet:</strong> Speed boost based on distance from
            leader (last place only)
          </div>
        </details>

        <h3 class="race-log-header">Race Log</h3>
        <div id="log" class="log"></div>

        <!-- Settings Button -->
        <!-- prettier-ignore -->
        <div class="sidebar-bottom-content">

        <button
        class="settings-btn"
        id="settingsBtn"
        onclick="window.game.openSettingsDialog()"
      >⚙️<span class="settings-btn-text">&nbsp;Settings</span>
      </button>
        </div>
      </div>
    </div>

    <div class="main-content">
      <div class="title-container">
        <div class="title-input-wrapper">
          <input
            type="text"
            id="raceTitle"
            class="race-title-input"
            value="Waddle Waddle"
            maxlength="50"
          />
          <button class="edit-title-btn" onclick="focusRaceTitle()">✏️</button>
        </div>
      </div>
      <div class="game-container">
        <canvas id="gameCanvas" width="800" height="400"></canvas>
      </div>
    </div>

    <script>
      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        const btn = document.getElementById("collapseBtn");

        sidebar.classList.toggle("collapsed");
        btn.classList.toggle("collapsed");
        btn.textContent = sidebar.classList.contains("collapsed") ? "▶" : "◀";
      }

      // Volume control functionality
      let isMuted = localStorage.getItem("volumeMuted") === "true";
      const backgroundMusic = document.getElementById("backgroundMusic");
      const volumeBtn = document.getElementById("volumeBtn");

      function toggleVolume() {
        isMuted = !isMuted;
        localStorage.setItem("volumeMuted", isMuted);
        backgroundMusic.muted = isMuted;
        volumeBtn.textContent = isMuted ? "🔇" : "🔊";
        volumeBtn.classList.toggle("muted", isMuted);
      }

      // Initialize background music with saved state
      backgroundMusic.volume = 0.3; // 30% volume
      backgroundMusic.muted = isMuted;
      volumeBtn.textContent = isMuted ? "🔇" : "🔊";
      volumeBtn.classList.toggle("muted", isMuted);

      // Play music when race starts
      window.playBackgroundMusic = function () {
        backgroundMusic.play().catch((error) => {
          console.log("Could not play background music:", error);
        });
      };

      // Stop music when race ends
      window.stopBackgroundMusic = function () {
        backgroundMusic.pause();
        backgroundMusic.currentTime = 0;
      };

      // Function to focus the race title input when pencil is clicked
      function focusRaceTitle() {
        const raceTitle = document.getElementById("raceTitle");
        raceTitle.focus();
        raceTitle.select();
      }
    </script>
    <script src="race-simulator.js"></script>
    <script src="duck-race.js"></script>
  </body>
</html>
